import { Component, HostListener, ElementRef } from '@angular/core';

@Component({
  selector: 'app-image-viewer',
  templateUrl: './image-viewer.component.html',
  styleUrls: ['./image-viewer.component.css']
})
export class ImageViewerComponent {
  images: string[] = [
    'https://example.com/image1.jpg',
    'https://example.com/image2.jpg',
    'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...',
    // Add more URLs or base64 strings here
  ];

  currentIndex: number = 0;
  scale: number = 1;
  rotation: number = 0;
  isFullScreen: boolean = false;

  constructor(private el: ElementRef) {}

  get currentImage() {
    return this.images[this.currentIndex];
  }

  nextImage() {
    if (this.currentIndex < this.images.length - 1) {
      this.currentIndex++;
      this.resetTransformations();
    }
  }

  prevImage() {
    if (this.currentIndex > 0) {
      this.currentIndex--;
      this.resetTransformations();
    }
  }

  zoomIn() {
    this.scale += 0.1;
  }

  zoomOut() {
    if (this.scale > 0.1) this.scale -= 0.1;
  }

  rotateClockwise() {
    this.rotation += 15;
  }

  rotateCounterClockwise() {
    this.rotation -= 15;
  }

  resetTransformations() {
    this.scale = 1;
    this.rotation = 0;
  }

  @HostListener('window:scroll', [])
  onWindowScroll() {
    this.lazyLoadImages();
  }

  lazyLoadImages() {
    const imageElement = this.el.nativeElement.querySelector('.current-image');
    if (imageElement) {
      const rect = imageElement.getBoundingClientRect();
      if (rect.top >= 0 && rect.bottom <= window.innerHeight) {
        this.preloadImage(imageElement);
      }
    }
  }

  preloadImage(img: HTMLImageElement) {
    const src = img.getAttribute('data-src');
    if (src) {
      img.src = src;
      img.removeAttribute('data-src');
    }
  }

  toggleFullScreen() {
    if (!this.isFullScreen) {
      if (this.el.nativeElement.requestFullscreen) {
        this.el.nativeElement.requestFullscreen();
      } else if (this.el.nativeElement.webkitRequestFullscreen) {
        this.el.nativeElement.webkitRequestFullscreen();
      } else if (this.el.nativeElement.msRequestFullscreen) {
        this.el.nativeElement.msRequestFullscreen();
      }
    } else {
      if (document.exitFullscreen) {
        document.exitFullscreen();
      } else if (document.webkitExitFullscreen) {
        document.webkitExitFullscreen();
      } else if (document.msExitFullscreen) {
        document.msExitFullscreen();
      }
    }
    this.isFullScreen = !this.isFullScreen;
  }
}


<div class="image-viewer">
  <div class="controls">
    <button (click)="prevImage()" [disabled]="currentIndex === 0">Previous</button>
    <button (click)="nextImage()" [disabled]="currentIndex === images.length - 1">Next</button>
    <button (click)="zoomIn()">Zoom In</button>
    <button (click)="zoomOut()">Zoom Out</button>
    <button (click)="rotateClockwise()">Rotate Clockwise</button>
    <button (click)="rotateCounterClockwise()">Rotate Counter Clockwise</button>
    <button (click)="resetTransformations()">Reset</button>
    <button (click)="toggleFullScreen()">Toggle Fullscreen</button>
  </div>

  <div class="image-container">
    <img class="current-image"
         [attr.data-src]="currentImage"
         [style.transform]="'scale(' + scale + ') rotate(' + rotation + 'deg)'"
         alt="Image Viewer">
  </div>

  <div class="thumbnail-container">
    <div *ngFor="let image of images; let i = index"
         class="thumbnail"
         [class.active]="i === currentIndex"
         (click)="currentIndex = i; resetTransformations()">
      <img [src]="image" alt="Thumbnail">
    </div>
  </div>
</div>

.image-viewer {
  text-align: center;
  position: relative;
}

.controls {
  margin-bottom: 10px;
}

.image-container {
  display: inline-block;
  max-width: 100%;
  max-height: 500px;
  overflow: hidden;
  position: relative;
}

img.current-image {
  max-width: 100%;
  max-height: 100%;
  transition: transform 0.3s ease;
}

.thumbnail-container {
  display: flex;
  justify-content: center;
  margin-top: 10px;
}

.thumbnail {
  width: 80px;
  height: 60px;
  overflow: hidden;
  margin: 0 5px;
  cursor: pointer;
  border: 2px solid transparent;
}

.thumbnail.active {
  border-color: blue;
}

.thumbnail img {
  width: 100%;
  height: auto;
  display: block;
}
