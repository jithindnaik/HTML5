import { Component, ElementRef, HostListener } from '@angular/core';

@Component({
  selector: 'app-image-viewer',
  templateUrl: './image-viewer.component.html',
  styleUrls: ['./image-viewer.component.css']
})
export class ImageViewerComponent {
  images: string[] = [
    'https://example.com/image1.jpg',
    'https://example.com/image2.jpg',
    'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...',
    // Add more URLs or base64 strings here
  ];

  currentIndex: number = 0;
  scale: number = 1;
  rotation: number = 0;
  isFullScreen: boolean = false;

  // Panning variables
  isPanning: boolean = false;
  startX: number = 0;
  startY: number = 0;
  translateX: number = 0;
  translateY: number = 0;
  lastTranslateX: number = 0;
  lastTranslateY: number = 0;

  constructor(private el: ElementRef) {}

  get currentImage() {
    return this.images[this.currentIndex];
  }

  nextImage() {
    if (this.currentIndex < this.images.length - 1) {
      this.currentIndex++;
      this.resetTransformations();
    }
  }

  prevImage() {
    if (this.currentIndex > 0) {
      this.currentIndex--;
      this.resetTransformations();
    }
  }

  zoomIn() {
    this.scale += 0.1;
  }

  zoomOut() {
    if (this.scale > 0.1) this.scale -= 0.1;
  }

  rotateClockwise() {
    this.rotation += 15;
  }

  rotateCounterClockwise() {
    this.rotation -= 15;
  }

  resetTransformations() {
    this.scale = 1;
    this.rotation = 0;
    this.translateX = 0;
    this.translateY = 0;
    this.lastTranslateX = 0;
    this.lastTranslateY = 0;
  }

  startPan(event: MouseEvent | TouchEvent) {
    this.isPanning = true;
    const clientX = event instanceof MouseEvent ? event.clientX : event.touches[0].clientX;
    const clientY = event instanceof MouseEvent ? event.clientY : event.touches[0].clientY;

    this.startX = clientX - this.lastTranslateX;
    this.startY = clientY - this.lastTranslateY;
  }

  pan(event: MouseEvent | TouchEvent) {
    if (!this.isPanning) return;

    const clientX = event instanceof MouseEvent ? event.clientX : event.touches[0].clientX;
    const clientY = event instanceof MouseEvent ? event.clientY : event.touches[0].clientY;

    this.translateX = clientX - this.startX;
    this.translateY = clientY - this.startY;
  }

  endPan() {
    this.isPanning = false;
    this.lastTranslateX = this.translateX;
    this.lastTranslateY = this.translateY;
  }

  toggleFullScreen() {
    // Full-screen code as before
  }
}


<div class="image-container"
     (mousedown)="startPan($event)"
     (mousemove)="pan($event)"
     (mouseup)="endPan()"
     (mouseleave)="endPan()"
     (touchstart)="startPan($event)"
     (touchmove)="pan($event)"
     (touchend)="endPan()">
  <img appLazyLoad="{{currentImage}}"
       class="current-image"
       [style.transform]="'translate(' + translateX + 'px, ' + translateY + 'px) scale(' + scale + ') rotate(' + rotation + 'deg)'"
       alt="Image Viewer">
</div>


.image-container {
  display: inline-block;
  max-width: 100%;
  max-height: 500px;
  overflow: hidden;
  position: relative;
  cursor: grab;
}

.image-container:active {
  cursor: grabbing;
}

img.current-image {
  transition: transform 0.1s ease;
  cursor: move;
  user-select: none;
  -webkit-user-drag: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
